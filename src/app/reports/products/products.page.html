

<ion-content [fullscreen]="true" *ngIf="!showProducts && !isLoading">
 <div class="title">Alege Perioada</div>
  <div class="grid-date">
    <ion-button fill="outline" mode="md" color="medium" (click)="pickStartDay()">{{startDay && startDay.length ? startDay : "ZI Început"}}</ion-button>
    <ion-label color="medium" *ngIf="startDay">LA</ion-label>
    <ion-label color="medium" *ngIf="!startDay" style="height: 13px"></ion-label>
    <ion-button fill="outline" mode="md" color="medium" (click)="pickEndDay()"[disabled]="!startDay"> {{endDay && endDay.length ? endDay : "Zi Sfârșit"}}</ion-button>
    <div class="filter-wrapper" *ngIf="endDay && endDay.length">
      <div class="first-col">
        <ion-checkbox labelPlacement="end" justify="start" [(ngModel)]="isProduction">Productie</ion-checkbox>
        <ion-checkbox labelPlacement="end" justify="start" [(ngModel)]="isGoods">Marfuri</ion-checkbox>
      </div>
      <div class="second-col">
        <ion-checkbox labelPlacement="end" justify="start" [(ngModel)]="isInreg">Inreg</ion-checkbox>
        <ion-checkbox labelPlacement="end" justify="start" [(ngModel)]="isUnreg">Unreg</ion-checkbox>
      </div>
    </div>
    <ion-button fill="outline" mode="md" color="primary" (click)="search()" *ngIf="endDay && endDay.length">CAUTĂ</ion-button>
  </div>
</ion-content>
<ion-content [fullscreen]="true" *ngIf="isLoading">
  <div class="grid-date">
    <app-spinner></app-spinner>
  </div>
</ion-content>

  <ion-toolbar *ngIf="showProducts && !isLoading">
    <!-- <div class="label">
        <ion-label *ngIf="startDay === endDay">
          {{startDay}}
        </ion-label>
        <ion-label *ngIf="startDay !== endDay">
          {{startDay}} -- {{endDay}}
        </ion-label>
    </div> -->
    <ion-buttons slot="end">
      <ion-button (click)="hide()">
        <ion-icon src="assets/icon/calendar.svg"></ion-icon>
      </ion-button>
        <ion-button (click)="openDownload()">
          <ion-icon src="assets/icon/download.svg"></ion-icon>
        </ion-button>
        <ion-button (click)="showConsumption()">
        {{showProductIngs ? "VÂNZĂRI" : "CONSUM"}}
      </ion-button>
    </ion-buttons>
  </ion-toolbar>

  <ion-content [fullscreen]="true" class="products-content" *ngIf="showProducts && !isLoading && !showProductIngs">
    <ion-grid *ngIf="sections">
      <ion-row>
        <ion-col size-lg="3" offset-lg="5">
          <div class="section" (click)="showMain('total')">
            <span style="font-size: 22px;">Total</span>
            <div class="sales">
              <span class="value">{{calcProductsTotal(dbProducts)}}</span>
              <span class="note">(Vânzări Lei)</span>
            </div>
            <div class="consumption">
              <span class="value">{{calcIngredientsTotal(dbIngs)}}</span>
              <span class="note">(Consum Lei)</span>
            </div>
            <div class="surplus">
              <span class="value">{{roundInHtml((calcProductsTotal(dbProducts) - calcIngredientsTotal(dbIngs)) / calcIngredientsTotal(dbIngs) * 100)}}</span>
              <span class="note">(Adaos %)</span>
            </div>
          </div>
        </ion-col>
      </ion-row>
    </ion-grid>

    <div class="title">Produse Vândute</div>

    <ion-item lines="none" slot="fixed" [ngClass]="{'cons': showProductIngs}">
      <div class="name head" (click)="filter('name')">
        <ion-icon src="assets/icon/arrows-down.svg" [color]="nameColor"></ion-icon>
        <span>Nume Produs</span>
      </div>
      <div class="search-bar">
        <ion-searchbar mode="ios" [(ngModel)]="productSearch"  placeholder="Caută produs..."  (ionInput)="searchProduct($event)" #searchbar>
        </ion-searchbar>
      </div>
      <div class="qty head hide"></div>
      <div class="qty head" (click)="filter('qty')">
        <span>Cantitate</span>
        <span>(UM)</span>
        <ion-icon src="assets/icon/arrows-down.svg" [color]="qtyColor"></ion-icon>
      </div>
      <div class="qty head" (click)="filter('price')">
        <span>Preț UM</span>
        <span>(RON)</span>
        <ion-icon src="assets/icon/arrows-down.svg" [color]="priceColor"></ion-icon>
      </div>
      <div class="qty head" (click)="filter('total')">
        <span>Total</span>
        <span>(RON)</span>
        <ion-icon src="assets/icon/arrows-down.svg" [color]="totColor"></ion-icon>
      </div>
      <div class="qty head" (click)="filter('disc')">
        <span>Discount</span>
        <span>(RON)</span>
        <ion-icon src="assets/icon/arrows-down.svg" [color]="discColor"></ion-icon>
      </div>
      <div class="qty head" (click)="filter('cashIn')">
        <span>Total Încasat</span>
        <span>(RON)</span>
        <ion-icon src="assets/icon/arrows-down.svg" [color]="cashInColor"></ion-icon>
      </div>
      <div class="qty head" (click)="filter('cons')">
        <span>Total Consum</span>
        <span>(RON)</span>
        <ion-icon src="assets/icon/arrows-down.svg" [color]="consColor"></ion-icon>
      </div>
      <div class="qty head" (click)="filter('surplus')">
        <span>Adaos</span>
        <span>(%)</span>
        <ion-icon src="assets/icon/arrows-down.svg" [color]="surplusColor"></ion-icon>
      </div>
    </ion-item>

    <div class="product-mobile" *ngFor="let product of products; let i = index">
      <ion-item lines="none" class="mobile-input" (click)="showRecipe(i, product)">
        <ion-grid>
          <ion-row>
            <ion-col size='1'>
              <span class="label">{{i+1}}.</span>
            </ion-col>
            <ion-col size="4">
              <span class="label" (click)="filter('name')">{{product.name}}</span>
            </ion-col>
            <ion-col size="2" (click)="filter('qty')">
              <span class="label">{{product.quantity}} buc</span>
            </ion-col>
            <ion-col  size="2" (click)="filter('cashIn')">
              <span class="label">{{roundInHtml(product.price*product.quantity - product.discount)}} Lei</span>
            </ion-col>
            <ion-col  size="3" (click)="filter('surplus')">
              <span class="label">{{roundInHtml(((product.price*product.quantity - product.discount) - calcConsInHtml(product)) / calcConsInHtml(product) * 100)}} %</span>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-item>
    </div>


    <div class="product-wrapper hide" *ngFor="let product of products; let i = index">
      <ion-item lines="none" class="ing-input" (click)="showRecipe(i, product)" [ngClass]="{'selected': i === selected}">
        <span class="index">{{i+1}}.</span>
        <span class="name">{{product.name}}</span>
        <span  class="qty" *ngIf="!product.showSub"></span>
        <span  class="qty" *ngIf="product.showSub">Rețetă</span>
        <span  class="qty">{{product.quantity}} buc</span>
        <span  class="qty">{{roundInHtml(product.price)}} Lei</span>
        <span  class="qty">{{roundInHtml(product.price*product.quantity)}} Lei</span>
        <span  class="qty">{{roundInHtml(product.discount)}} Lei</span>
        <span  class="qty">{{roundInHtml(product.price*product.quantity - product.discount)}} Lei</span>
        <span  class="qty">{{calcConsInHtml(product)}} Lei</span>
        <span  class="qty">{{roundInHtml(((product.price*product.quantity - product.discount) - calcConsInHtml(product)) / calcConsInHtml(product) * 100)}} %</span>
      </ion-item>
      <div class="recipe-wrapper" *ngIf="product.showSub">
        <div class="ings-wrapper" *ngFor="let ing of product.ingr">
          <ion-item lines="none" class="input" *ngIf="ing.ing">
            <ion-label class="name">{{ing.ing.name}} (Ingredient)</ion-label>
            <ion-label  class="qty">{{roundInHtml(ing.qty / product.quantity)}} {{ing.ing.um}}</ion-label>
            <ion-label  class="qty">{{roundInHtml(ing.qty)}} {{ing.ing.um}}</ion-label>
            <ion-label  class="qty">{{roundInHtml(ing.ing.tvaPrice)}} Lei</ion-label>
            <ion-label  class="qty">{{roundInHtml(ing.ing.tvaPrice*ing.qty)}} Lei</ion-label>
            <ion-label  class="qty"></ion-label>
            <ion-label  class="qty"></ion-label>
            <ion-label  class="qty"></ion-label>
            <ion-label  class="qty"></ion-label>
          </ion-item>
        </div>
        <ion-item lines="none" class="input">
          <ion-label  class="name bold">Total consum</ion-label>
          <ion-label  class="qty"></ion-label>
          <ion-label  class="qty"></ion-label>
          <ion-label  class="qty"></ion-label>
          <ion-label  class="qty"></ion-label>
          <ion-label  class="qty bold">{{calcRecipeTotal()}} Lei</ion-label>
          <ion-label  class="qty"></ion-label>
          <ion-label  class="qty"></ion-label>
          <ion-label  class="qty"></ion-label>
          <ion-label  class="qty"></ion-label>
        </ion-item>
      </div>
    </div>
  </ion-content>
  <ion-content [fullscreen]="true" class="reports-content" *ngIf="showProductIngs">
    <div class="ing title">Ingrediente Consumate</div>
    <ion-item lines="none" slot="fixed" id="cons">
      <div class="name head" (click)="filterIngs('name')">
        <ion-icon src="assets/icon/arrows-down.svg" [color]="nameColor"></ion-icon>
        <span>Nume Ingredient</span>
      </div>
      <div class="search-bar">
        <ion-searchbar mode="ios" [(ngModel)]="ingSearch"  placeholder="Caută ingredient..."  (ionInput)="searchIng($event)" #searchbar>
        </ion-searchbar>
      </div>
      <div class="qty head" (click)="filterIngs('qty')">
        <span>Qty</span>
        <ion-icon src="assets/icon/arrows-down.svg" [color]="qtyColor"></ion-icon>
      </div>
      <div class="qty head" (click)="filterIngs('um')">
        <span>UM</span>
        <ion-icon src="assets/icon/arrows-down.svg" [color]="surplusColor"></ion-icon>
      </div>
      <div class="qty head" (click)="filterIngs('price')">
        <span>Preț UM</span>
        <span>(RON)</span>
        <ion-icon src="assets/icon/arrows-down.svg" [color]="priceColor"></ion-icon>
      </div>
      <div class="qty head" (click)="filterIngs('tot')">
        <span>Total</span>
        <span>(RON)</span>
        <ion-icon src="assets/icon/arrows-down.svg" [color]="totColor"></ion-icon>
      </div>
    </ion-item>
    <ion-item lines="none" class="ing-input hide" *ngFor="let ing of allIngredients; let i=index">
      <ion-label class="index">{{i+1}}.</ion-label>
      <ion-label class="name">{{ing.ing.name}}</ion-label>
      <ion-label  class="qty">{{roundInHtml(ing.qty)}}</ion-label>
      <ion-label  class="qty">{{ing.ing.um}}</ion-label>
      <ion-label  class="qty">{{roundInHtml(ing.ing.tvaPrice)}}</ion-label>
      <ion-label  class="qty">{{roundInHtml(ing.ing.tvaPrice*ing.qty)}}</ion-label>
    </ion-item>
    <div class="ing-mobile" *ngFor="let ing of allIngredients; let i=index">
      <ion-item lines="none" class="mobile-input">
        <ion-grid>
          <ion-row>
            <ion-col size='1'>
              <span class="label">{{i+1}}.</span>
            </ion-col>
            <ion-col size="6">
              <span class="label" (click)="filterIngs('name')">{{ing.ing.name}}</span>
            </ion-col>
            <ion-col size="2" (click)="filterIngs('qty')">
              <span class="label">{{roundInHtml(ing.qty)}} {{ing.ing.um}}</span>
            </ion-col>
            <ion-col  size="3" (click)="filterIngs('tot')">
              <span class="label">{{roundInHtml(ing.ing.tvaPrice*ing.qty)}} Lei</span>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-item>
    </div>
  </ion-content>
